syntax = "proto3";

package a3s.code.agent.v1;

// ============================================================================
// A3S Code Agent Service
// ============================================================================
// Standard coding agent interface. Any agent implementing this interface
// can be integrated into A3S Box.

service CodeAgentService {
  // === Lifecycle Management ===
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
  rpc GetCapabilities(GetCapabilitiesRequest) returns (GetCapabilitiesResponse);
  rpc Initialize(InitializeRequest) returns (InitializeResponse);
  rpc Shutdown(ShutdownRequest) returns (ShutdownResponse);

  // === Session Management ===
  rpc CreateSession(CreateSessionRequest) returns (CreateSessionResponse);
  rpc DestroySession(DestroySessionRequest) returns (DestroySessionResponse);
  rpc ListSessions(ListSessionsRequest) returns (ListSessionsResponse);
  rpc GetSession(GetSessionRequest) returns (GetSessionResponse);
  rpc ConfigureSession(ConfigureSessionRequest) returns (ConfigureSessionResponse);
  rpc GetMessages(GetMessagesRequest) returns (GetMessagesResponse);

  // === Code Generation ===
  rpc Generate(GenerateRequest) returns (GenerateResponse);
  rpc StreamGenerate(GenerateRequest) returns (stream GenerateChunk);
  rpc GenerateStructured(GenerateStructuredRequest) returns (GenerateStructuredResponse);
  rpc StreamGenerateStructured(GenerateStructuredRequest) returns (stream GenerateStructuredChunk);

  // === Skill Management ===
  rpc LoadSkill(LoadSkillRequest) returns (LoadSkillResponse);
  rpc UnloadSkill(UnloadSkillRequest) returns (UnloadSkillResponse);
  rpc ListSkills(ListSkillsRequest) returns (ListSkillsResponse);

  // === Context Management ===
  rpc GetContextUsage(GetContextUsageRequest) returns (GetContextUsageResponse);
  rpc CompactContext(CompactContextRequest) returns (CompactContextResponse);
  rpc ClearContext(ClearContextRequest) returns (ClearContextResponse);

  // === Event Streaming ===
  rpc SubscribeEvents(SubscribeEventsRequest) returns (stream AgentEvent);

  // === Control Operations ===
  rpc Cancel(CancelRequest) returns (CancelResponse);
  rpc Pause(PauseRequest) returns (PauseResponse);
  rpc Resume(ResumeRequest) returns (ResumeResponse);

  // === Human-in-the-Loop (HITL) ===
  rpc ConfirmToolExecution(ConfirmToolExecutionRequest) returns (ConfirmToolExecutionResponse);
  rpc SetConfirmationPolicy(SetConfirmationPolicyRequest) returns (SetConfirmationPolicyResponse);
  rpc GetConfirmationPolicy(GetConfirmationPolicyRequest) returns (GetConfirmationPolicyResponse);

  // === External Task Handling (Pluggable Handlers) ===
  rpc SetLaneHandler(SetLaneHandlerRequest) returns (SetLaneHandlerResponse);
  rpc GetLaneHandler(GetLaneHandlerRequest) returns (GetLaneHandlerResponse);
  rpc CompleteExternalTask(CompleteExternalTaskRequest) returns (CompleteExternalTaskResponse);
  rpc ListPendingExternalTasks(ListPendingExternalTasksRequest) returns (ListPendingExternalTasksResponse);

  // === Permission System (Allow/Deny/Ask Rules) ===
  rpc SetPermissionPolicy(SetPermissionPolicyRequest) returns (SetPermissionPolicyResponse);
  rpc GetPermissionPolicy(GetPermissionPolicyRequest) returns (GetPermissionPolicyResponse);
  rpc CheckPermission(CheckPermissionRequest) returns (CheckPermissionResponse);
  rpc AddPermissionRule(AddPermissionRuleRequest) returns (AddPermissionRuleResponse);

  // === Todo/Task Tracking ===
  rpc GetTodos(GetTodosRequest) returns (GetTodosResponse);
  rpc SetTodos(SetTodosRequest) returns (SetTodosResponse);

  // === Provider Configuration ===
  rpc ListProviders(ListProvidersRequest) returns (ListProvidersResponse);
  rpc GetProvider(GetProviderRequest) returns (GetProviderResponse);
  rpc AddProvider(AddProviderRequest) returns (AddProviderResponse);
  rpc UpdateProvider(UpdateProviderRequest) returns (UpdateProviderResponse);
  rpc RemoveProvider(RemoveProviderRequest) returns (RemoveProviderResponse);
  rpc SetDefaultModel(SetDefaultModelRequest) returns (SetDefaultModelResponse);
  rpc GetDefaultModel(GetDefaultModelRequest) returns (GetDefaultModelResponse);

  // === Planning & Goal Tracking (Phase 1) ===
  rpc CreatePlan(CreatePlanRequest) returns (CreatePlanResponse);
  rpc GetPlan(GetPlanRequest) returns (GetPlanResponse);
  rpc ExtractGoal(ExtractGoalRequest) returns (ExtractGoalResponse);
  rpc CheckGoalAchievement(CheckGoalAchievementRequest) returns (CheckGoalAchievementResponse);

  // === Memory System (Phase 3) ===
  rpc StoreMemory(StoreMemoryRequest) returns (StoreMemoryResponse);
  rpc RetrieveMemory(RetrieveMemoryRequest) returns (RetrieveMemoryResponse);
  rpc SearchMemories(SearchMemoriesRequest) returns (SearchMemoriesResponse);
  rpc GetMemoryStats(GetMemoryStatsRequest) returns (GetMemoryStatsResponse);
  rpc ClearMemories(ClearMemoriesRequest) returns (ClearMemoriesResponse);
}

// ============================================================================
// Lifecycle Management Messages
// ============================================================================

message HealthCheckRequest {}

message HealthCheckResponse {
  enum Status {
    STATUS_UNKNOWN = 0;
    STATUS_HEALTHY = 1;
    STATUS_DEGRADED = 2;
    STATUS_UNHEALTHY = 3;
  }

  Status status = 1;
  string message = 2;
  map<string, string> details = 3;
}

message GetCapabilitiesRequest {}

message GetCapabilitiesResponse {
  AgentInfo info = 1;
  repeated string features = 2;
  repeated ToolCapability tools = 3;
  repeated ModelCapability models = 4;
  ResourceLimits limits = 5;
  map<string, string> metadata = 6;
}

message AgentInfo {
  string name = 1;
  string version = 2;
  string description = 3;
  string author = 4;
  string license = 5;
  string homepage = 6;
}

message ToolCapability {
  string name = 1;
  string description = 2;
  repeated string parameters = 3;
  bool async = 4;
}

message ModelCapability {
  string provider = 1;
  string model = 2;
  repeated string features = 3;
}

message ResourceLimits {
  uint64 max_context_tokens = 1;
  uint32 max_concurrent_sessions = 2;
  uint32 max_tools_per_request = 3;
}

message InitializeRequest {
  string workspace = 1;
  map<string, string> env = 2;
}

message InitializeResponse {
  bool success = 1;
  string message = 2;
  AgentInfo info = 3;
}

message LLMConfig {
  string provider = 1;
  string model = 2;
  string api_key = 3;
  string base_url = 4;
  float temperature = 5;
  uint32 max_tokens = 6;
}

message ShutdownRequest {}

message ShutdownResponse {
  bool success = 1;
  string message = 2;
}

// ============================================================================
// Session Management Messages
// ============================================================================

message CreateSessionRequest {
  optional string session_id = 1;
  SessionConfig config = 2;
  repeated Message initial_context = 3;
}

message CreateSessionResponse {
  string session_id = 1;
  Session session = 2;
}

message SessionConfig {
  string name = 1;
  string workspace = 2;
  optional LLMConfig llm = 3;
  string system_prompt = 4;
  uint32 max_context_length = 5;
  bool auto_compact = 6;
  StorageType storage_type = 7;
}

enum StorageType {
  STORAGE_TYPE_UNSPECIFIED = 0;
  STORAGE_TYPE_MEMORY = 1;
  STORAGE_TYPE_FILE = 2;
}

message Session {
  string session_id = 1;
  SessionConfig config = 2;
  SessionState state = 3;
  ContextUsage context_usage = 4;
  int64 created_at = 5;
  int64 updated_at = 6;
}

enum SessionState {
  SESSION_STATE_UNKNOWN = 0;
  SESSION_STATE_ACTIVE = 1;
  SESSION_STATE_PAUSED = 2;
  SESSION_STATE_COMPLETED = 3;
  SESSION_STATE_ERROR = 4;
}

message ContextUsage {
  uint32 total_tokens = 1;
  uint32 prompt_tokens = 2;
  uint32 completion_tokens = 3;
  uint32 message_count = 4;
}

message DestroySessionRequest {
  string session_id = 1;
}

message DestroySessionResponse {
  bool success = 1;
}

message ListSessionsRequest {}

message ListSessionsResponse {
  repeated Session sessions = 1;
}

message GetSessionRequest {
  string session_id = 1;
}

message GetSessionResponse {
  Session session = 1;
}

message ConfigureSessionRequest {
  string session_id = 1;
  SessionConfig config = 2;
}

message ConfigureSessionResponse {
  Session session = 1;
}

// Get messages (conversation history) for a session
message GetMessagesRequest {
  string session_id = 1;
  optional uint32 limit = 2;      // Max number of messages to return (default: all)
  optional uint32 offset = 3;     // Skip first N messages (for pagination)
}

message GetMessagesResponse {
  repeated ConversationMessage messages = 1;
  uint32 total_count = 2;         // Total number of messages in session
  bool has_more = 3;              // Whether there are more messages after this batch
}

// Rich message format for conversation history
message ConversationMessage {
  string id = 1;                  // Unique message ID
  string role = 2;                // "user", "assistant", "system"
  repeated ContentBlock content = 3;
  int64 timestamp = 4;            // Unix timestamp (milliseconds)
  map<string, string> metadata = 5;
}

// Content block within a message
message ContentBlock {
  oneof block {
    TextContent text = 1;
    ToolUseContent tool_use = 2;
    ToolResultContent tool_result = 3;
  }
}

message TextContent {
  string text = 1;
}

message ToolUseContent {
  string id = 1;
  string name = 2;
  string arguments = 3;  // JSON string
}

message ToolResultContent {
  string tool_use_id = 1;
  string content = 2;
  bool is_error = 3;
}

// ============================================================================
// Code Generation Messages
// ============================================================================

message GenerateRequest {
  string session_id = 1;
  repeated Message messages = 2;
}

message Message {
  enum Role {
    ROLE_UNKNOWN = 0;
    ROLE_USER = 1;
    ROLE_ASSISTANT = 2;
    ROLE_SYSTEM = 3;
    ROLE_TOOL = 4;
  }

  Role role = 1;
  string content = 2;
  map<string, string> metadata = 3;
}

message GenerateResponse {
  string session_id = 1;
  Message message = 2;
  repeated ToolCall tool_calls = 3;
  Usage usage = 4;
  FinishReason finish_reason = 5;
  map<string, string> metadata = 6;
}

message ToolCall {
  string id = 1;
  string name = 2;
  string arguments = 3;
  optional ToolResult result = 4;
}

message ToolResult {
  bool success = 1;
  string output = 2;
  string error = 3;
  map<string, string> metadata = 4;
}

message Usage {
  uint32 prompt_tokens = 1;
  uint32 completion_tokens = 2;
  uint32 total_tokens = 3;
}

enum FinishReason {
  FINISH_REASON_UNKNOWN = 0;
  FINISH_REASON_STOP = 1;
  FINISH_REASON_LENGTH = 2;
  FINISH_REASON_TOOL_CALLS = 3;
  FINISH_REASON_CONTENT_FILTER = 4;
  FINISH_REASON_ERROR = 5;
}

message GenerateChunk {
  enum ChunkType {
    CHUNK_TYPE_UNKNOWN = 0;
    CHUNK_TYPE_CONTENT = 1;
    CHUNK_TYPE_TOOL_CALL = 2;
    CHUNK_TYPE_TOOL_RESULT = 3;
    CHUNK_TYPE_METADATA = 4;
    CHUNK_TYPE_DONE = 5;
  }

  ChunkType type = 1;
  string session_id = 2;
  string content = 3;
  optional ToolCall tool_call = 4;
  optional ToolResult tool_result = 5;
  map<string, string> metadata = 6;
}

message GenerateStructuredRequest {
  string session_id = 1;
  repeated Message messages = 2;
  string schema = 3;  // JSON Schema
}

message GenerateStructuredResponse {
  string session_id = 1;
  string data = 2;  // JSON format
  Usage usage = 3;
  map<string, string> metadata = 4;
}

message GenerateStructuredChunk {
  string session_id = 1;
  string data = 2;
  bool done = 3;
}

// ============================================================================
// Skill Management Messages
// ============================================================================

message LoadSkillRequest {
  string session_id = 1;
  string skill_name = 2;
  optional string skill_content = 3;
}

message LoadSkillResponse {
  bool success = 1;
  repeated string tool_names = 2;
}

message UnloadSkillRequest {
  string session_id = 1;
  string skill_name = 2;
}

message UnloadSkillResponse {
  bool success = 1;
  repeated string removed_tools = 2;
}

message ListSkillsRequest {
  optional string session_id = 1;
}

message ListSkillsResponse {
  repeated Skill skills = 1;
}

message Skill {
  string name = 1;
  string description = 2;
  repeated string tools = 3;
  map<string, string> metadata = 4;
}

// ============================================================================
// Context Management Messages
// ============================================================================

message GetContextUsageRequest {
  string session_id = 1;
}

message GetContextUsageResponse {
  ContextUsage usage = 1;
}

message CompactContextRequest {
  string session_id = 1;
}

message CompactContextResponse {
  bool success = 1;
  ContextUsage before = 2;
  ContextUsage after = 3;
}

message ClearContextRequest {
  string session_id = 1;
}

message ClearContextResponse {
  bool success = 1;
}

// ============================================================================
// Event Streaming Messages
// ============================================================================

message SubscribeEventsRequest {
  optional string session_id = 1;
  repeated string event_types = 2;
}

message AgentEvent {
  enum EventType {
    EVENT_TYPE_UNKNOWN = 0;
    EVENT_TYPE_SESSION_CREATED = 1;
    EVENT_TYPE_SESSION_DESTROYED = 2;
    EVENT_TYPE_GENERATION_STARTED = 3;
    EVENT_TYPE_GENERATION_COMPLETED = 4;
    EVENT_TYPE_TOOL_CALLED = 5;
    EVENT_TYPE_TOOL_COMPLETED = 6;
    EVENT_TYPE_ERROR = 7;
    EVENT_TYPE_WARNING = 8;
    EVENT_TYPE_INFO = 9;
    // HITL events
    EVENT_TYPE_CONFIRMATION_REQUIRED = 10;
    EVENT_TYPE_CONFIRMATION_RECEIVED = 11;
    EVENT_TYPE_CONFIRMATION_TIMEOUT = 12;
    // External task events
    EVENT_TYPE_EXTERNAL_TASK_PENDING = 13;
    EVENT_TYPE_EXTERNAL_TASK_COMPLETED = 14;
    // Permission events
    EVENT_TYPE_PERMISSION_DENIED = 15;
    // Memory System events (Phase 3)
    EVENT_TYPE_MEMORY_STORED = 16;
    EVENT_TYPE_MEMORY_RECALLED = 17;
    EVENT_TYPE_MEMORIES_SEARCHED = 18;
    EVENT_TYPE_MEMORY_CLEARED = 19;
  }

  EventType type = 1;
  optional string session_id = 2;
  int64 timestamp = 3;
  string message = 4;
  map<string, string> data = 5;
}

// ============================================================================
// Control Operations Messages
// ============================================================================

message CancelRequest {
  string session_id = 1;
  optional string operation_id = 2;
}

message CancelResponse {
  bool success = 1;
}

message PauseRequest {
  string session_id = 1;
}

message PauseResponse {
  bool success = 1;
}

message ResumeRequest {
  string session_id = 1;
}

message ResumeResponse {
  bool success = 1;
}

// ============================================================================
// Human-in-the-Loop (HITL) Messages
// ============================================================================

// Confirm tool execution request
message ConfirmToolExecutionRequest {
  string session_id = 1;
  string tool_id = 2;
  bool approved = 3;
  optional string reason = 4;
}

message ConfirmToolExecutionResponse {
  bool success = 1;
  string error = 2;
}

// Session queue lane type
enum SessionLane {
  SESSION_LANE_UNKNOWN = 0;
  SESSION_LANE_CONTROL = 1;  // P0 - pause, resume, cancel
  SESSION_LANE_QUERY = 2;    // P1 - read, glob, ls, grep
  SESSION_LANE_EXECUTE = 3;  // P2 - bash, write, edit
  SESSION_LANE_GENERATE = 4; // P3 - LLM calls
}

// Timeout behavior
enum TimeoutAction {
  TIMEOUT_ACTION_UNKNOWN = 0;
  TIMEOUT_ACTION_REJECT = 1;      // Reject on timeout
  TIMEOUT_ACTION_AUTO_APPROVE = 2; // Auto-approve on timeout
}

// Confirmation policy configuration
message ConfirmationPolicy {
  bool enabled = 1;                          // Whether HITL is enabled (default: false)
  repeated string auto_approve_tools = 2;    // Tools to auto-approve
  repeated string require_confirm_tools = 3; // Tools requiring confirmation
  uint64 default_timeout_ms = 4;             // Default timeout (30s)
  TimeoutAction timeout_action = 5;          // Timeout behavior
  repeated SessionLane yolo_lanes = 6;       // YOLO mode: tasks in these lanes auto-approve
}

// Set confirmation policy request
message SetConfirmationPolicyRequest {
  string session_id = 1;
  ConfirmationPolicy policy = 2;
}

message SetConfirmationPolicyResponse {
  bool success = 1;
  ConfirmationPolicy policy = 2;
}

// Get confirmation policy request
message GetConfirmationPolicyRequest {
  string session_id = 1;
}

message GetConfirmationPolicyResponse {
  ConfirmationPolicy policy = 1;
}

// ============================================================================
// External Task Handling (Pluggable Handlers) Messages
// ============================================================================

// Task handler mode
enum TaskHandlerMode {
  TASK_HANDLER_MODE_UNKNOWN = 0;
  TASK_HANDLER_MODE_INTERNAL = 1;  // Internal handling (default)
  TASK_HANDLER_MODE_EXTERNAL = 2;  // External handling (send to SDK, wait for callback)
  TASK_HANDLER_MODE_HYBRID = 3;    // Hybrid mode (internal handling with external notification)
}

// Lane handler configuration
message LaneHandlerConfig {
  TaskHandlerMode mode = 1;
  uint64 timeout_ms = 2;  // External handling timeout (milliseconds)
}

// Set lane handler request
message SetLaneHandlerRequest {
  string session_id = 1;
  SessionLane lane = 2;
  LaneHandlerConfig config = 3;
}

message SetLaneHandlerResponse {
  bool success = 1;
  LaneHandlerConfig config = 2;
}

// Get lane handler request
message GetLaneHandlerRequest {
  string session_id = 1;
  SessionLane lane = 2;
}

message GetLaneHandlerResponse {
  LaneHandlerConfig config = 1;
}

// External task
message ExternalTask {
  string task_id = 1;
  string session_id = 2;
  SessionLane lane = 3;
  string command_type = 4;
  string payload = 5;       // Task data in JSON format
  uint64 timeout_ms = 6;
  uint64 remaining_ms = 7;  // Remaining timeout
}

// Complete external task request
message CompleteExternalTaskRequest {
  string session_id = 1;
  string task_id = 2;
  bool success = 3;
  string result = 4;   // Result in JSON format
  string error = 5;    // Error message (if failed)
}

message CompleteExternalTaskResponse {
  bool success = 1;
  string error = 2;
}

// List pending external tasks request
message ListPendingExternalTasksRequest {
  string session_id = 1;
}

message ListPendingExternalTasksResponse {
  repeated ExternalTask tasks = 1;
}

// ============================================================================
// Permission System (Allow/Deny/Ask Rules) Messages
// ============================================================================

// Permission decision
enum PermissionDecision {
  PERMISSION_DECISION_UNKNOWN = 0;
  PERMISSION_DECISION_ALLOW = 1;   // Auto-allow
  PERMISSION_DECISION_DENY = 2;    // Deny
  PERMISSION_DECISION_ASK = 3;     // Requires confirmation
}

// Permission rule
message PermissionRule {
  string rule = 1;  // e.g., "Bash(cargo:*)", "Read(src/**/*.rs)"
}

// Permission policy
message PermissionPolicy {
  repeated PermissionRule deny = 1;   // Deny rules (highest priority)
  repeated PermissionRule allow = 2;  // Allow rules
  repeated PermissionRule ask = 3;    // Ask rules
  PermissionDecision default_decision = 4;  // Default decision
  bool enabled = 5;  // Whether permission system is enabled
}

// Set permission policy request
message SetPermissionPolicyRequest {
  string session_id = 1;
  PermissionPolicy policy = 2;
}

message SetPermissionPolicyResponse {
  bool success = 1;
  PermissionPolicy policy = 2;
}

// Get permission policy request
message GetPermissionPolicyRequest {
  string session_id = 1;
}

message GetPermissionPolicyResponse {
  PermissionPolicy policy = 1;
}

// Check permission request
message CheckPermissionRequest {
  string session_id = 1;
  string tool_name = 2;
  string arguments = 3;  // JSON format
}

message CheckPermissionResponse {
  PermissionDecision decision = 1;
  repeated string matching_rules = 2;  // Matching rules (for debugging)
}

// Add permission rule request
message AddPermissionRuleRequest {
  string session_id = 1;
  string rule_type = 2;  // "allow", "deny", or "ask"
  string rule = 3;       // e.g., "Bash(cargo:*)"
}

message AddPermissionRuleResponse {
  bool success = 1;
  string error = 2;
}

// ============================================================================
// Todo/Task Tracking Messages
// ============================================================================

// Todo item for task tracking
message Todo {
  string id = 1;
  string content = 2;
  string status = 3;    // pending, in_progress, completed, cancelled
  string priority = 4;  // high, medium, low
}

// Get todos request
message GetTodosRequest {
  string session_id = 1;
}

message GetTodosResponse {
  repeated Todo todos = 1;
}

// Set todos request (replaces entire list)
message SetTodosRequest {
  string session_id = 1;
  repeated Todo todos = 2;
}

message SetTodosResponse {
  bool success = 1;
  repeated Todo todos = 2;
}

// ============================================================================
// Provider Configuration Messages
// ============================================================================

// Model cost information (per million tokens)
message ModelCostInfo {
  double input = 1;        // Input token cost
  double output = 2;       // Output token cost
  double cache_read = 3;   // Cache read cost
  double cache_write = 4;  // Cache write cost
}

// Model token limits
message ModelLimitInfo {
  uint32 context = 1;  // Maximum context tokens
  uint32 output = 2;   // Maximum output tokens
}

// Model modalities (input/output types)
message ModelModalitiesInfo {
  repeated string input = 1;   // Supported input types (text, image, pdf)
  repeated string output = 2;  // Supported output types (text)
}

// Model configuration
message ModelInfo {
  string id = 1;                      // Model ID (e.g., "claude-sonnet-4-20250514")
  string name = 2;                    // Display name
  string family = 3;                  // Model family (e.g., "claude-sonnet")
  optional string api_key = 4;        // Per-model API key override
  optional string base_url = 5;       // Per-model base URL override
  bool attachment = 6;                // Supports file attachments
  bool reasoning = 7;                 // Supports reasoning/thinking
  bool tool_call = 8;                 // Supports tool calling
  bool temperature = 9;               // Supports temperature setting
  optional string release_date = 10;  // Release date
  ModelModalitiesInfo modalities = 11;
  ModelCostInfo cost = 12;
  ModelLimitInfo limit = 13;
}

// Provider configuration
message ProviderInfo {
  string name = 1;                // Provider name (e.g., "anthropic", "openai")
  optional string api_key = 2;    // API key for this provider
  optional string base_url = 3;   // Base URL for the API
  repeated ModelInfo models = 4;  // Available models
}

// List all providers
message ListProvidersRequest {}

message ListProvidersResponse {
  repeated ProviderInfo providers = 1;
  optional string default_provider = 2;
  optional string default_model = 3;
}

// Get a specific provider
message GetProviderRequest {
  string name = 1;
}

message GetProviderResponse {
  ProviderInfo provider = 1;
}

// Add a new provider
message AddProviderRequest {
  ProviderInfo provider = 1;
}

message AddProviderResponse {
  bool success = 1;
  string error = 2;
  ProviderInfo provider = 3;
}

// Update an existing provider
message UpdateProviderRequest {
  ProviderInfo provider = 1;  // Provider name identifies which to update
}

message UpdateProviderResponse {
  bool success = 1;
  string error = 2;
  ProviderInfo provider = 3;
}

// Remove a provider
message RemoveProviderRequest {
  string name = 1;
}

message RemoveProviderResponse {
  bool success = 1;
  string error = 2;
}

// Set default provider and model
message SetDefaultModelRequest {
  string provider = 1;  // Provider name
  string model = 2;     // Model ID
}

message SetDefaultModelResponse {
  bool success = 1;
  string error = 2;
  string provider = 3;
  string model = 4;
}

// Get current default provider and model
message GetDefaultModelRequest {}

message GetDefaultModelResponse {
  optional string provider = 1;
  optional string model = 2;
}

// ============================================================================
// Planning & Goal Tracking Messages (Phase 1)
// ============================================================================

// Task complexity level
enum Complexity {
  COMPLEXITY_UNKNOWN = 0;
  COMPLEXITY_SIMPLE = 1;
  COMPLEXITY_MEDIUM = 2;
  COMPLEXITY_COMPLEX = 3;
  COMPLEXITY_VERY_COMPLEX = 4;
}

// Step status in execution plan
enum StepStatus {
  STEP_STATUS_UNKNOWN = 0;
  STEP_STATUS_PENDING = 1;
  STEP_STATUS_IN_PROGRESS = 2;
  STEP_STATUS_COMPLETED = 3;
  STEP_STATUS_FAILED = 4;
  STEP_STATUS_SKIPPED = 5;
}

// Individual execution step
message PlanStep {
  string id = 1;
  string description = 2;
  optional string tool = 3;
  repeated string dependencies = 4;
  StepStatus status = 5;
  repeated string success_criteria = 6;
}

// Complete execution plan
message ExecutionPlan {
  string goal = 1;
  repeated PlanStep steps = 2;
  Complexity complexity = 3;
  repeated string required_tools = 4;
  uint32 estimated_steps = 5;
}

// Agent goal with success criteria
message AgentGoal {
  string description = 1;
  repeated string success_criteria = 2;
  float progress = 3;
  bool achieved = 4;
  int64 created_at = 5;
  optional int64 achieved_at = 6;
}

// Create an execution plan
message CreatePlanRequest {
  string session_id = 1;
  string prompt = 2;
  optional string context = 3;
}

message CreatePlanResponse {
  ExecutionPlan plan = 1;
}

// Get an existing plan
message GetPlanRequest {
  string session_id = 1;
  string plan_id = 2;
}

message GetPlanResponse {
  ExecutionPlan plan = 1;
}

// Extract goal from prompt
message ExtractGoalRequest {
  string session_id = 1;
  string prompt = 2;
}

message ExtractGoalResponse {
  AgentGoal goal = 1;
}

// Check if goal is achieved
message CheckGoalAchievementRequest {
  string session_id = 1;
  AgentGoal goal = 2;
  string current_state = 3;
}

message CheckGoalAchievementResponse {
  bool achieved = 1;
  float progress = 2;
  repeated string remaining_criteria = 3;
}

// ============================================================================
// Memory System Messages (Phase 3)
// ============================================================================

// Memory type classification
enum MemoryType {
  MEMORY_TYPE_UNKNOWN = 0;
  MEMORY_TYPE_EPISODIC = 1;
  MEMORY_TYPE_SEMANTIC = 2;
  MEMORY_TYPE_PROCEDURAL = 3;
  MEMORY_TYPE_WORKING = 4;
}

// Single memory item
message MemoryItem {
  string id = 1;
  string content = 2;
  int64 timestamp = 3;
  float importance = 4;
  repeated string tags = 5;
  MemoryType memory_type = 6;
  map<string, string> metadata = 7;
  uint32 access_count = 8;
  optional int64 last_accessed = 9;
}

// Memory statistics
message MemoryStats {
  uint64 long_term_count = 1;
  uint64 short_term_count = 2;
  uint64 working_count = 3;
}

// Store a memory
message StoreMemoryRequest {
  string session_id = 1;
  MemoryItem memory = 2;
}

message StoreMemoryResponse {
  bool success = 1;
  string memory_id = 2;
}

// Retrieve a memory by ID
message RetrieveMemoryRequest {
  string session_id = 1;
  string memory_id = 2;
}

message RetrieveMemoryResponse {
  optional MemoryItem memory = 1;
}

// Search memories
message SearchMemoriesRequest {
  string session_id = 1;
  optional string query = 2;
  repeated string tags = 3;
  uint32 limit = 4;
  bool recent_only = 5;
  optional float min_importance = 6;
}

message SearchMemoriesResponse {
  repeated MemoryItem memories = 1;
  uint32 total_count = 2;
}

// Get memory statistics
message GetMemoryStatsRequest {
  string session_id = 1;
}

message GetMemoryStatsResponse {
  MemoryStats stats = 1;
}

// Clear memories
message ClearMemoriesRequest {
  string session_id = 1;
  bool clear_long_term = 2;
  bool clear_short_term = 3;
  bool clear_working = 4;
}

message ClearMemoriesResponse {
  bool success = 1;
  uint64 cleared_count = 2;
}
